
<div class="container mt-4">

<div class="card shadow-sm border-0">
  <div class="card-body">

    <h3 class="fw-semibold mb-3"><%= listing.title %></h3>

    <div id="listingCarousel" class="carousel slide mb-3">

<div class="carousel-inner rounded">

  <% if(listing.images && listing.images.length > 0){ %>

  <% listing.images.forEach((img, index) => { %>
    <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
      <img src="<%= img.url %>" class="d-block w-100" style="height:400px; object-fit:cover;">
    </div>
  <% }) %>

  <% } else if(listing.image && listing.image.url){ %>

    <!-- OLD DATA SUPPORT -->
    <div class="carousel-item active">
      <img src="<%= listing.image.url %>" class="d-block w-100" style="height:400px; object-fit:cover;">
    </div>

  <% } else { %>

    <div class="carousel-item active">
      <img src="https://via.placeholder.com/800x400" class="d-block w-100">
    </div>

  <% } %>

</div>

  <!-- controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#listingCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>

  <button class="carousel-control-next" type="button" data-bs-target="#listingCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>

</div>

    <p class="text-muted"><%= listing.description %></p>

    <p class="mb-1"><strong>Price:</strong> â‚¹ <%= listing.price %></p>
    <p class="mb-1"><strong>Location:</strong> <%= listing.location %></p>
    <p class="mb-3"><strong>Country:</strong> <%= listing.country %></p>

    <div class="d-flex gap-2">
        <a href="/listings" class="btn btn-outline-dark btn-sm">Back</a>

        <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
            <button class="btn btn-outline-danger btn-sm">Delete</button>
        </form>
    </div>

  </div>
</div>

<div id="map" class="mt-3 rounded">
       data-coordinates='<%- JSON.stringify(listing.geometry.coordinates) %>'>
</div>

</div>


<script>
  const coordinates = <%- JSON.stringify(listing.geometry.coordinates) %>;

  const map = L.map('map').setView([coordinates[1], coordinates[0]], 9);

  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  L.marker([coordinates[1], coordinates[0]])
    .addTo(map)
    .bindPopup("<%= listing.title %>")
    .openPopup();
</script>

<script src="/js/map.js"></script>
