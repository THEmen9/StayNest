

<div class="container mt-4">

<div class="card shadow-sm border-0">
  <div class="card-body">

    <h3 class="fw-semibold mb-3"><%= listing.title %></h3>

    <div id="listingCarousel" class="carousel slide mb-3">

<div class="carousel-inner rounded">

 <% if(listing.images && listing.images.length){ %>

<div id="listingCarousel" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-inner">

    <% listing.images.forEach((img, index) => { %>
      <div class="carousel-item <%= index === 0 ? 'active' : '' %>">
        <img src="<%= img.url.startsWith('http') ? img.url : '/' + img.url %>"
             class="d-block w-100 rounded"
             style="height:450px; object-fit:cover;">
      </div>
    <% }) %>

  </div>

  <% if(listing.images.length > 1){ %>
    <button class="carousel-control-prev" type="button" data-bs-target="#listingCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#listingCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
    </button>
  <% } %>
</div>

<% } %>


</div>

  <!-- controls -->
  <button class="carousel-control-prev" type="button" data-bs-target="#listingCarousel" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>

  <button class="carousel-control-next" type="button" data-bs-target="#listingCarousel" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>

</div>

    <p class="text-muted"><%= listing.description %></p>

    <p class="mb-1"><strong>Price:</strong> â‚¹ <%= listing.price %></p>
    <p class="mb-1"><strong>Location:</strong> <%= listing.location %></p>
    <p class="mb-3"><strong>Country:</strong> <%= listing.country %></p>

    <div class="d-flex gap-2">
        <!-- <a href="/listings" class="btn btn-outline-dark btn-sm">Back</a> -->
       <% if(
            currentUser &&
            listing.owner &&
            (listing.owner.toString() === currentUser._id.toString() ||
              currentUser.role === "dev")
          ){ %>

            <a href="/listings/<%= listing._id %>/edit" class="btn btn-dark">Edit</a>

            <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
                <button class="btn btn-danger">Delete</button>
            </form>

      <% } %>


    </div>

  </div>
</div>

<div id="map" class="mt-3 rounded">
       data-coordinates='<%- JSON.stringify(listing.geometry.coordinates) %>'>
</div>

</div>


<script>
    const listing = <%- JSON.stringify(listing) %>;

    const coords = [
        listing.geometry.coordinates[1], // lat
        listing.geometry.coordinates[0]  // lng
    ];

    const map = L.map('map').setView(coords, 10);

    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
    }).addTo(map);

    L.marker(coords)
        .addTo(map)
        .bindPopup(`<b>${listing.title}</b><br>${listing.location}`)
        .openPopup();
</script>


<script src="/js/map.js"></script>
