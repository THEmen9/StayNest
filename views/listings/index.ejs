<div class="container py-4">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <div class="mb-4">
            <h2 class="fw-semibold">Explore Stays</h2>
            <p class="text-muted small m-0">
            Find places that feel like home</p>
        </div>
            <a href="/listings/new" class="btn btn-outline-dark btn-sm">
            + New
            </a>  
        </div>

    <div class="row g-4">

    <% allListings.forEach(listing => { %>

        <div class="col-lg-4 col-md-6">

            <div class="card listing-card h-100 border-0 shadow-sm">

                <div class="img-wrapper">
                    <% if(listing.images && listing.images.length){ %>
                    <img src="<%= listing.images[0].url.startsWith('http') 
                            ? listing.images[0].url 
                            : '/' + listing.images[0].url %>"
                            class="card-img-top"
                            style="height:250px; object-fit:cover;">
                        <% if(listing.images && listing.images.length > 1){ %>
                                <span class="badge bg-dark position-absolute top-0 end-0 m-2">
                                    +<%= listing.images.length - 1 %> photos
                                </span>
                        <% } %>
                    <% } else { %>
                    <img src="/default.jpg" class="card-img-top">
                    <% } %>       
                </div>

                <div class="card-body d-flex flex-column">

                    <h5 class="card-title fw-semibold">
                        <%= listing.title %>
                    </h5>

                    <p class="text-muted mb-3">
                        â‚¹ <%= listing.price %>
                    </p>

                    <div class="mt-auto d-flex gap-2">

                        <a href="/listings/<%= listing._id %>" 
                           class="btn btn-dark btn-sm flex-fill">
                           View
                        </a>

                       <% if(
                            currentUser &&
                            listing.owner &&
                            (listing.owner._id.toString() === currentUser._id.toString() ||
                                currentUser.role === "dev")
                            ){ %>

                            <a href="/listings/<%= listing._id %>/edit" class="btn btn-sm btn-dark">Edit</a>

                            <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST" style="display:inline;">
                                <button class="btn btn-sm btn-danger">Delete</button>
                            </form>

                            <% } %>

                    </div>

                </div>

            </div>

        </div>

    <% }) %>

    </div>
</div>
